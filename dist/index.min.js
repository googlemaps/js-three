this.google=this.google||{},this.google.maps=this.google.maps||{},this.google.maps.plugins=this.google.maps.plugins||{},this.google.maps.plugins.three=function(t,e){"use strict";const{atan:r,cos:i,exp:s,log:n,tan:a,PI:o}=Math,{degToRad:h,radToDeg:l}=e.MathUtils,d=6371010,c=Math.PI*d;function g(t){return window.google&&google.maps&&(t instanceof google.maps.LatLng||t instanceof google.maps.LatLngAltitude)?{altitude:0,...t.toJSON()}:{altitude:0,...t}}function u(t,r){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new e.Vector3;const[n,a]=p(t),[o,l]=p(r);return s.set(n-o,a-l,0),s.multiplyScalar(i(h(r.lat))),s.z=t.altitude-r.altitude,s}function p(t){return[d*h(t.lng),d*n(a(.25*o+.5*h(t.lat)))]}const y=new e.Vector3(0,0,1);return t.EARTH_RADIUS=d,t.ThreeJSOverlayView=class{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.animationMode="ondemand",this.rotationArray=new Float32Array(3),this.rotationInverse=new e.Quaternion,this.projectionMatrixInverse=new e.Matrix4,this.raycaster=new e.Raycaster;const{anchor:r={lat:0,lng:0,altitude:0},upAxis:i="Z",scene:s,map:n,animationMode:a="ondemand",addDefaultLighting:o=!0}=t;this.overlay=new google.maps.WebGLOverlayView,this.renderer=null,this.camera=null,this.animationMode=a,this.setAnchor(r),this.setUpAxis(i),this.scene=s??new e.Scene,o&&this.initSceneLights(),this.overlay.onAdd=this.onAdd.bind(this),this.overlay.onRemove=this.onRemove.bind(this),this.overlay.onContextLost=this.onContextLost.bind(this),this.overlay.onContextRestored=this.onContextRestored.bind(this),this.overlay.onStateUpdate=this.onStateUpdate.bind(this),this.overlay.onDraw=this.onDraw.bind(this),this.camera=new e.PerspectiveCamera,n&&this.setMap(n)}setAnchor(t){this.anchor=g(t)}setUpAxis(t){const r=new e.Vector3(0,0,1);"string"!=typeof t?r.copy(t):"y"===t.toLowerCase()?r.set(0,1,0):"z"!==t.toLowerCase()&&console.warn(`invalid value '${t}' specified as upAxis`),r.normalize();const i=new e.Quaternion;i.setFromUnitVectors(r,y),this.rotationInverse.copy(i).invert();const s=(new e.Euler).setFromQuaternion(i,"XYZ");this.rotationArray[0]=e.MathUtils.radToDeg(s.x),this.rotationArray[1]=e.MathUtils.radToDeg(s.y),this.rotationArray[2]=e.MathUtils.radToDeg(s.z)}raycast(t,e){let r,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};Array.isArray(e)?r=e||null:(r=[this.scene],i={...e,recursive:!0});const{updateMatrix:s=!0,recursive:n=!1,raycasterParameters:a}=i;s&&this.projectionMatrixInverse.copy(this.camera.projectionMatrix).invert(),this.raycaster.ray.origin.set(t.x,t.y,0).applyMatrix4(this.projectionMatrixInverse),this.raycaster.ray.direction.set(t.x,t.y,.5).applyMatrix4(this.projectionMatrixInverse).sub(this.raycaster.ray.origin).normalize();const o=this.raycaster.params;a&&(this.raycaster.params=a);const h=this.raycaster.intersectObjects(r,n);return this.raycaster.params=o,h}onStateUpdate(){}onAdd(){}onBeforeDraw(){}onRemove(){}requestStateUpdate(){this.overlay.requestStateUpdate()}requestRedraw(){this.overlay.requestRedraw()}getMap(){return this.overlay.getMap()}setMap(t){this.overlay.setMap(t)}addListener(t,e){return this.overlay.addListener(t,e)}onContextRestored(t){let{gl:r}=t;this.renderer=new e.WebGLRenderer({canvas:r.canvas,context:r,...r.getContextAttributes()}),this.renderer.autoClear=!1,this.renderer.autoClearDepth=!1,this.renderer.shadowMap.enabled=!0,this.renderer.shadowMap.type=e.PCFSoftShadowMap,Number(e.REVISION)<152&&(this.renderer.outputEncoding=e.sRGBEncoding);const{width:i,height:s}=r.canvas;this.renderer.setViewport(0,0,i,s)}onContextLost(){this.renderer&&(this.renderer.dispose(),this.renderer=null)}onDraw(t){let{gl:e,transformer:r}=t;this.camera.projectionMatrix.fromArray(r.fromLatLngAltitude(this.anchor,this.rotationArray)),e.disable(e.SCISSOR_TEST),this.onBeforeDraw(),this.renderer.render(this.scene,this.camera),this.renderer.resetState(),"always"===this.animationMode&&this.requestRedraw()}latLngAltitudeToVector3(t){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new e.Vector3;return u(g(t),this.anchor,r),r.applyQuaternion(this.rotationInverse),r}bindTo(t,e,r,i){this.overlay.bindTo(t,e,r,i)}get(t){return this.overlay.get(t)}notify(t){this.overlay.notify(t)}set(t,e){this.overlay.set(t,e)}setValues(t){this.overlay.setValues(t)}unbind(t){this.overlay.unbind(t)}unbindAll(){this.overlay.unbindAll()}initSceneLights(){const t=new e.HemisphereLight(16777215,4473924,1);t.position.set(0,-.2,1).normalize();const r=new e.DirectionalLight(16777215);r.position.set(0,10,100),this.scene.add(t,r)}},t.WORLD_SIZE=c,t.latLngToVector3Relative=u,t.latLngToXY=p,t.toLatLngAltitudeLiteral=g,t.xyToLatLng=function(t){const[e,i]=t;return{lat:l(.5*o-2*r(s(-i/d))),lng:l(e)/d}},t}({},THREE);
//# sourceMappingURL=index.min.js.map
